<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§¯åˆ†ç»Ÿè®¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
        }

        h1, h2 {
            text-align: center;
        }

        label {
            display: block;
            margin-bottom: 10px;
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        button {
            flex: 1;
            padding: 10px;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button.add-player {
            background-color: #28a745;
        }

        button.add-player:hover {
            background-color: #218838;
        }

        button.add-round {
            background-color: #007bff;
        }

        button.add-round:hover {
            background-color: #0056b3;
        }

        button.reset {
            background-color: #dc3545;
        }

        button.reset:hover {
            background-color: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            width: 80px;
        }

        th {
            background-color: #f8f9fa;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            padding: 8px;
            background-color: #f8f9fa;
            margin-bottom: 5px;
            border-radius: 4px;
        }

        .table-container {
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç§¯åˆ†ç»Ÿè®¡</h1>
        <div id="score-inputs">
            <h2>è¾“å…¥æ¯å±€ç§¯åˆ†</h2>
            <div id="inputs"></div>
            <div class="button-group">
                <button class="add-round" onclick="addRound()">âœ… æ·»åŠ æœ¬å±€ç§¯åˆ†</button>
            </div>
            <div class="button-group">
                <button class="add-player" onclick="addPlayer()">â• å¢åŠ ç©å®¶</button>
                <button class="reset" onclick="resetData()">ğŸ”„ é‡ç½®</button>
            </div>
        </div>
        <div id="results" style="display:none;">
            <h2>æ€»åˆ†</h2>
            <ul id="total-scores"></ul>
            <h2>ç§¯åˆ†è®°å½•</h2>
            <div id="rounds-tables"></div>
        </div>
    </div>

    <script>
        let players = [];
        let totalScores = {};
        let rounds = [];

        // ä» localStorage åŠ è½½æ•°æ®
        function loadData() {
            const savedPlayers = localStorage.getItem('players');
            const savedTotalScores = localStorage.getItem('totalScores');
            const savedRounds = localStorage.getItem('rounds');

            if (savedPlayers) players = JSON.parse(savedPlayers);
            if (savedTotalScores) totalScores = JSON.parse(savedTotalScores);
            if (savedRounds) rounds = JSON.parse(savedRounds);

            updateInputs();
            updateTables();
            displayResults();
        }

        // ä¿å­˜æ•°æ®åˆ° localStorage
        function saveData() {
            localStorage.setItem('players', JSON.stringify(players));
            localStorage.setItem('totalScores', JSON.stringify(totalScores));
            localStorage.setItem('rounds', JSON.stringify(rounds));
        }

        // æ›´æ–°è¾“å…¥æ¡†
        function updateInputs() {
            const inputsContainer = document.getElementById('inputs');
            inputsContainer.innerHTML = players.map((player, index) => `
                <label for="player${index + 1}">${player}ç§¯åˆ†:</label>
                <input type="number" id="score${index + 1}" class="score-input" value="0">
            `).join('');
        }

        // å¢åŠ ç©å®¶
        function addPlayer() {
            const newPlayerName = prompt("è¯·è¾“å…¥æ–°å¢ç©å®¶çš„å§“åï¼š");
            if (!newPlayerName) {
                alert("ç©å®¶å§“åä¸èƒ½ä¸ºç©º");
                return;
            }

            players.push(newPlayerName);
            totalScores[newPlayerName] = 0;

            updateInputs();
            updateTables();
            saveData();
        }

        // æ·»åŠ ä¸€å±€ç§¯åˆ†
        function addRound() {
            if (players.length === 0) {
                alert("è¯·å…ˆæ·»åŠ ç©å®¶ï¼");
                return;
            }

            // äºŒæ¬¡ç¡®è®¤
            const confirmAdd = confirm("ç¡®å®šè¦æ·»åŠ æœ¬å±€ç§¯åˆ†å—ï¼Ÿ");
            if (!confirmAdd) return;

            const roundScores = {};
            let totalRoundScore = 0;

            // è·å–æ¯å±€ç§¯åˆ†å¹¶è®¡ç®—æ€»å’Œ
            for (let i = 1; i <= players.length; i++) {
                const playerName = players[i - 1];
                const score = parseInt(document.getElementById(`score${i}`).value) || 0;
                roundScores[playerName] = score;
                totalRoundScore += score;
            }

            // æ ¡éªŒæœ¬å±€ç§¯åˆ†æ€»å’Œæ˜¯å¦ä¸º0
            if (totalRoundScore !== 0) {
                alert("æœ¬å±€ç§¯åˆ†æ€»å’Œå¿…é¡»ä¸º0ï¼Œè¯·æ£€æŸ¥å¹¶é‡æ–°è¾“å…¥ï¼");
                return;
            }

            // æ›´æ–°æ€»åˆ†
            for (const [player, score] of Object.entries(roundScores)) {
                totalScores[player] += score;
            }

            rounds.push(roundScores);
            updateTables();
            displayResults();
            saveData();

            // æ¸…ç©ºç§¯åˆ†è¾“å…¥æ¡†
            clearInputs();
        }

        // æ¸…ç©ºç§¯åˆ†è¾“å…¥æ¡†
        function clearInputs() {
            for (let i = 1; i <= players.length; i++) {
                document.getElementById(`score${i}`).value = 0;
            }
        }

        // æ›´æ–°ç§¯åˆ†è®°å½•è¡¨æ ¼
        function updateTables() {
            const tablesContainer = document.getElementById('rounds-tables');
            tablesContainer.innerHTML = '';

            const chunkSize = 5;
            for (let i = 0; i < players.length; i += chunkSize) {
                const chunkPlayers = players.slice(i, i + chunkSize);
                const tableHTML = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>å±€æ•°</th>
                                    ${chunkPlayers.map(player => `<th>${player}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${rounds.map((round, index) => `
                                    <tr>
                                        <td>ç¬¬${index + 1}å±€</td>
                                        ${chunkPlayers.map(player => `<td>${round[player] || 0}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                tablesContainer.innerHTML += tableHTML;
            }
        }

        // æ˜¾ç¤ºæ€»åˆ†
        function displayResults() {
            let resultsHTML = '';
            for (const [player, score] of Object.entries(totalScores)) {
                resultsHTML += `<li>${player}: ${score} åˆ†</li>`;
            }

            document.getElementById('total-scores').innerHTML = resultsHTML;
            document.getElementById('results').style.display = 'block';
        }

        // é‡ç½®æ•°æ®
        function resetData() {
            const confirmReset = confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼");
            if (!confirmReset) return;

            players = [];
            totalScores = {};
            rounds = [];
            localStorage.clear();

            updateInputs();
            updateTables();
            displayResults();
        }

        // é¡µé¢åŠ è½½æ—¶åŠ è½½æ•°æ®
        window.onload = loadData;
    </script>
</body>
</html>